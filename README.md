# 動態鬆弛腳本 (Dynamic Relaxation Script)

## 概述

此腳本基於 **動態鬆弛法** (Dynamic Relaxation) 用於模擬網格殼結構的放鬆形態，並通過 Grasshopper 提供可視化輸出。

### 功能
- 模擬基於彈簧和節點的動態系統。
- 接收 Rhino 幾何作為輸入，包括線段和 3D 點。
- 自動生成放鬆後的網格殼形態。

---

主要包含以下三個類別：

1. **`SpringSystem`**
   - 管理彈簧和節點。
   - 提供構建與模擬動態系統的核心方法。
2. **`Node`**
   - 定義節點的索引、質量、支撐屬性及其連接的彈簧。
3. **`Spring`**
   - 定義彈簧的兩端節點、剛度、原始長度及其力學屬性。

---

### 使用流程

1. **初始化 (`initialize`)**
   - 清除舊的數據結構。
   - 建立新系統，將節點與彈簧進行關聯。
   - 設置支撐點。

2. **運行 (`run`)**
   - 基於輸入參數（如彈簧剛度、節點質量等）模擬系統動態行為。
   - 使用 Verlet 積分法更新節點位置和速度。

---

## 輸入與輸出

### 輸入
- **`lines`**：網格殼的線段（Rhino Geometry）。
- **`supports`**：固定支撐點（3D 點）。
- **`springStiffness`**：彈簧剛度。
- **`systemDamping`**：系統阻尼。
- **`nodeMass`**：節點質量。
- **`timestep`**：時間步長。
- **`appliedLoad`**：應用的負載。

### 輸出
- **`A`**：放鬆後的網格線段（Rhino Geometry）。
- **`B`**：系統能量歷史。
- **`C`**：節點的當前位置。
- **`D`**：當前能量。
- **`E`**：能量變化率。

---

## 關鍵功能

### 彈簧 (`Spring`) 類
- **`Length()`**：計算當前彈簧長度。
- **`Strain()`**：計算彈簧應變。
- **`Force()`**：計算彈簧的恢復力。
- **`NewLine()`**：生成新的 Rhino 線段。

### 節點 (`Node`) 類
- 管理節點的屬性（如索引、質量和是否為支撐點）。
- 維護與該節點相連的彈簧列表。

### 彈簧系統 (`SpringSystem`) 類
- **`Build()`**：從輸入線段構建彈簧和節點系統。
- **`SetSupport()`**：設置支撐節點。
- **`SetForces()`**：計算節點間的力。
- **`Verlet()`**：使用 Verlet 積分法模擬節點運動。
- **`Move()`**：驅動系統運行。
- **`Draw()`**：生成放鬆後的線段。

---

## 算法描述

### Verlet 積分法
1. 計算節點的加速度。
2. 基於當前位置和速度，計算下一步位置。
3. 更新節點的動能，並計算系統總能量。

### 能量跟蹤
- 系統會記錄歷史能量，通過能量變化率判斷是否達到收斂狀態。

---

## 示例使用

1. **在 Grasshopper 中添加腳本組件**。
2. 將以下參數連接到腳本組件：
   - 線段 (`lines`)。
   - 支撐點 (`supports`)。
   - 其他物理參數（剛度、阻尼、質量等）。
3. 設置 `initialize` 為 `true`，初始化系統。
4. 切換 `run` 為 `true`，開始運行動態模擬。

---

## 依賴

此腳本依賴以下命名空間：

- `Rhino` 和 `Rhino.Geometry`
- `Grasshopper.Kernel` 和相關庫
- 標準 C# 命名空間，如 `System.Collections.Generic` 和 `System.Linq`


## 注意事項
- 運行時，請合理設置時間步長 (`timestep`)，避免模擬數值不穩定。
- 請確保輸入幾何（線段和支撐點）在 Rhino 中已正確定義。

